<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clinic Pre-Visit Check-In</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .card {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      max-width: 500px;
      text-align: center;
    }
    button {
      padding: 12px 20px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      background: #2d7ff9;
      color: white;
    }
    .status {
      margin-top: 20px;
      font-size: 14px;
      word-break: break-word;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>

<div class="card">
  <h2>Family Van Health Care Clinic</h2>
  <p>Start Pre-Visit Check-In</p>
  <button id="startBtn">Start Check-In</button>
  <div id="status" class="status"></div>
</div>

<script>
  // üîê HARD-CODED API KEY (NOT SAFE FOR PRODUCTION)
  const API_KEY = "a763ac6319a0412394e0c10296c929c6";

  const context = `
You are interviewing patients at a family van health care clinic.
Follow the script exactly and speak in Spanish.

Start with:
‚ÄúHi, welcome to the Family Van Health Care Clinic. Let‚Äôs get you checked in!‚Äù
section1:
‚ÄúFirst, what name would you like us to call you?‚Äù
(Pause)
‚ÄúHello <whatever name they give you>, What‚Äôs your date of birth?‚Äù
(Pause)
‚ÄúWhat phone number should we use to reach you?‚Äù
(Pause)
‚ÄúIs it okay for us to text you about your care?
Please say ‚Äòyes‚Äô or ‚Äòno.‚Äô‚Äù
(Pause)
‚ÄúGreat. Let‚Äôs move on.‚Äù

section2: contact
‚ÄúIn case of emergency, who should we contact?‚Äù
(Pause)
‚ÄúWhat is your relationship to them?‚Äù
(Pause)
‚ÄúWhat‚Äôs their phone number?‚Äù
(Pause)
‚ÄúThank you.‚Äù

Section 3 ‚Äî Why Are You Here Today?
‚ÄúWhy are you here today?
You can name one or more reasons.‚Äù
(Pause ‚Äî allow open response)
‚ÄúIf you‚Äôd like, say a sentence in your own words about what‚Äôs going on.‚Äù
(Pause)
‚ÄúGot it.‚Äù

Section 4 ‚Äî Medical Basics
‚ÄúDo you have any allergies?‚Äù
(Pause)
‚ÄúAre you taking any medications?‚Äù
(Pause)
‚ÄúDo you have any ongoing health conditions?‚Äù
(Pause)
‚ÄúThank you.‚Äù

Section 5 ‚Äî Insurance
‚ÄúDo you have health insurance?
Say ‚Äòyes,‚Äô ‚Äòno,‚Äô or ‚Äònot sure.‚Äô‚Äù
(Pause)
‚ÄúIf yes, what company?‚Äù
(Pause)
‚ÄúIf no or not sure ‚Äî would you like help finding low-cost care?‚Äù

(Pause)
‚ÄúThanks.‚Äù
Section 6 ‚Äî Privacy &amp; Signature
‚ÄúHow would you like us to contact you about results ‚Äî
text, or call?‚Äù
(Pause)
‚ÄúIs it okay to share results with a parent or guardian?
Say ‚Äòyes,‚Äô ‚Äòno‚Äô.‚Äù
(Pause)
‚ÄúOne last question. Are you having thoughts of hurting yourself today?
Please say ‚Äòyes‚Äô or ‚Äòno.‚Äô‚Äù
‚ÄúPlease sign below with your finger.‚Äù
(Pause)
‚ÄúThank you. That completes the check-in ."


`;

  const payload = {
    test_mode: false,
    replica_id: "r3f427f43c9d",
    persona_id: "pcd235e789c2",
    callback_url: "https://clinicfeedback.org/",
    conversation_name: "Pre Visit Checkin",
    custom_greeting: "Hola, bienvenido a la cl√≠nica de salud Family Van. ¬°Vamos a hacer su registro!",
    conversational_context: context,
    properties: {
      max_call_duration: 300,
      participant_left_timeout: 300,
      participant_absent_timeout: 300,
      language: "spanish",
      enable_closed_captions: true,
      apply_greenscreen: false
    }
  };

  const statusDiv = document.getElementById("status");
  const startBtn = document.getElementById("startBtn");

  startBtn.addEventListener("click", async () => {
    startBtn.disabled = true;
    statusDiv.innerHTML = "Creating conversation...";

    try {
      const response = await fetch("https://tavusapi.com/v2/conversations", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "x-api-key": API_KEY
        },
        body: JSON.stringify(payload)
      });

      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.error || data.message || "Unknown error");
      }

      const conversationUrl = data.conversation_url;

      statusDiv.innerHTML = `
        ‚úÖ Conversation Created<br>
        Redirecting to session...
      `;

      console.log("Conversation created:", data);

      // üöÄ Redirect user to Tavus session
      window.location.href = conversationUrl;

    } catch (err) {
      statusDiv.innerHTML = `<span class="error">Error: ${err.message}</span>`;
      startBtn.disabled = false;
    }
  });
</script>

</body>
</html>
